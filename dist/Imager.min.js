/*!
 * Imager v0.1.6
 * (c) 2020 321jiangtao@gmail.com
 * Released under the  License.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("exif-js")):"function"==typeof define&&define.amd?define(["exif-js"],t):e.Imager=t(e.EXIF)}(this,function(e){"use strict";var t=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,i){var u={key:e,arg:t,resolve:n,reject:i,next:null};a?a=a.next=u:(o=a=u,r(e,t))})}function r(n,o){try{var a=t[n](o),u=a.value;u instanceof e?Promise.resolve(u.value).then(function(e){r("next",e)},function(e){r("throw",e)}):i(a.done?"return":"normal",a.value)}catch(e){i("throw",e)}}function i(e,t){switch(e){case"return":o.resolve({value:t,done:!0});break;case"throw":o.reject(t);break;default:o.resolve({value:t,done:!1})}o=o.next,o?r(o.key,o.arg):a=null}var o,a;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();return"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");e=Object(e);for(var t=1;t<arguments.length;t++){var n=arguments[t];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}),function(){function r(e){t(this,r);var n={maxWidth:1e3,maxHeight:1e3,quality:.9,isLimit:!0,exifdata:{Orientation:""}};Object.assign(this,n,e)}return n(r,[{key:"expectSize",value:function(e){var t=void 0,n=void 0,r=void 0,i=void 0,o=this.maxWidth,a=this.maxHeight;return t=r=e.naturalWidth,n=i=e.naturalHeight,this.isLimit&&(r>i&&r>o?(t=o,n=t*i/r):i>r&&i>a&&(n=a,t=n*r/i)),{width:t,height:n}}},{key:"loaded",value:function(){var e=this,t=new Image,n=(this.maxWidth,this.maxHeight,this.file.exifdata.Orientation),i=this.quality;return r.fileToBase64(this.file).then(function(o){return t.src=o,new Promise(function(o,a){t.addEventListener("load",function(){var a=void 0,u=void 0,c=e.expectSize(t),f=c.width,s=c.height;if(a=document.createElement("canvas"),u=a.getContext("2d"),a.width=f,a.height=s,u.drawImage(t,0,0,f,s),""!=n&&1!=n)switch(n){case 6:r.rotateImg(t,"left",a);break;case 8:r.rotateImg(t,"right",a);break;case 3:r.rotateImg(t,"right",a),r.rotateImg(t,"right",a)}o(a.toDataURL("image/png",i))}),t.addEventListener("err",a)})})}},{key:"getExif",value:function(){var t=this;return new Promise(function(n){e.getData(t.file,function(){e.getAllTags(t.file),n(t.file)})})}}],[{key:"supportFileReader",value:function(){return!!window.FileReader}},{key:"supportFile",value:function(){return window.File&&window.atob&&window.Uint8Array}},{key:"isImage",value:function(e){return e.type.indexOf("image")>-1}},{key:"base64ToFile",value:function(e,t){if(!r.supportFile())return e;for(var n=e.split(","),i=n[0].match(/:(.*?);/)[1],o=atob(n[1]),a=o.length,u=new Uint8Array(a);a--;)u[a]=o.charCodeAt(a);return new File([u],t,{type:i})}},{key:"fileToBase64",value:function(e){if(!r.supportFileReader())return Promise.reject(new Error("browser not support FileReader"));var t=new FileReader;return t.readAsDataURL(e),new Promise(function(e,n){t.addEventListener("load",function(){return e(t.result)}),t.addEventListener("error",n)})}},{key:"rotateImg",value:function(e,t,n){if(null!=e){var r=e.height,i=e.width,o=2;null==o&&(o=0),"right"==t?++o>3&&(o=0):--o<0&&(o=3);var a=90*o*Math.PI/180,u=n.getContext("2d");switch(o){case 0:n.width=i,n.height=r,u.drawImage(e,0,0);break;case 1:n.width=r,n.height=i,u.rotate(a),u.drawImage(e,0,-r);break;case 2:n.width=i,n.height=r,u.rotate(a),u.drawImage(e,-i,-r);break;case 3:n.width=r,n.height=i,u.rotate(a),u.drawImage(e,-i,0)}}}}]),r}()});
//# sourceMappingURL=Imager.min.js.map